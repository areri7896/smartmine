{%extends 'src/dashboard/basic.html' %}
{% load static %}

<title>{% block title %} Dashboard | SmartMine Landing Page & Dashboard {% endblock %} </title>

{% block csx %}
{% endblock %}

{% block css_links %}
<link href="{% static 'assets/media/images/icons/logo.svg' %}" rel="shortcut icon" type="image/x-icon" />
<!-- Start::Global Styles (used by all pages) -->
<link href="{% static 'assets/css/styles.bundle.css' %}" rel="stylesheet" type="text/css" />
<!-- End::Global Styles -->
<!-- Start::Plugins (used by this page) -->
<link href="{% static 'assets/plugins/apexcharts/apexcharts.css' %}" rel="stylesheet" type="text/css" />
<!-- End::Plugins -->
<!-- Start::Page Styles (used by this page) -->
<link href="{% static 'assets/css/pages/dashboard-v1.css' %}" rel="stylesheet" type="text/css" />
<!-- End::Page Styles -->

{% endblock %}
{% block content %}

<body class="">

  <div class="dashboard dashboard--v1">
    <div class="container container--dashboard">
      <div class="dashboard__group">
        <!-- Section::Balance Section -->

        <!-- Reveal Balance Modal -->
        <div class="modal fade" id="revealModal" tabindex="-1" aria-labelledby="revealModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark text-white">
              <div class="modal-header border-bottom-0">
                <h5 class="modal-title" id="revealModalLabel">Verify Identity to Reveal Balance</h5>
                <button type="button" class="btn-close bg-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body text-center py-4">
       
                <img src="{% static 'assets/media/images/icons/security.png' %}" alt="Security" style="width: 80px;"
                  class="mb-3">
                <p class="mb-4">Click below to confirm your identity via your authenticator app.</p>
                <form action="{% url 'verify_otp_reveal' %}" method="post">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-primary btn-lg btn-pill w-100">Verify and Reveal</button>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Start::Complete Card -->
        <div class="complete-card complete-card--type-1-v1">
          <div class="complete-card__balance">
            <div class="complete-card__balance-head">
              <div class="complete-card__balance-head__title">
                <h6 class="complete-card__balance-head__title-text">Balance</h6>
                <div class="complete-card__balance-head__title-influsion">
                  <img src="{% static 'assets/media/images/icons/arrow-bullish.svg' %}" alt=""
                    class="complete-card__balance-head__title-influsion-icon">
                  <p
                    class="fb-regular fb-regular--bold complete-card__balance-head__title-influsion-value text-bullish">
                    2.36%</p>
                </div>
              </div>
              <div class="d-flex align-items-center justify-content-between">
                <div>
                  <p class="complete-card__balance-head__value">
                    ksh {% if request.session.balances_revealed %}{{ bal }}{% else %}*******{% endif %}
                  </p>
                  <p class="complete-card__balance-head__value">
                    ${% if request.session.balances_revealed %}{{ bal_usd.converted_amount }}{% else %}*******{% endif%}
                    USD
                  </p>
                </div>
                {% if not request.session.balances_revealed %}
                <button type="button" class="btn btn-outline-primary btn-sm btn-pill" data-bs-toggle="modal"
                  data-bs-target="#revealModal">
                  Reveal
                </button>
                {% else %}
                <a href="{% url 'hide_balances_session' %}" class="btn btn-outline-secondary btn-sm btn-pill">Hide</a>
                {% endif %}
              </div>
            </div>
            <div class="complete-card__balance-revenue">
              <div class="complete-card__balance-revenue__income">
                <div class="balance-revenue__income-title">
                  <img src="{% static 'assets/media/images/icons/arrow-bullish.svg' %}" alt=""
                    class="balance-revenue__income-title-icon">
                  <p class="fb-regular balance-revenue__income-title-text">Income</p>
                </div>
                <!-- <p class="fd-sm fd-sm--bold balance-revenue__income-value">USD 12.243,55</p> -->
              </div>
              <div class="complete-card__balance-revenue__separator"></div>
              <div class="complete-card__balance-revenue__expenses">
                <div class="balance-revenue__expenses-title">
                  <img src="{% static 'assets/media/images/icons/arrow-bearish.svg' %}" alt=""
                    class="balance-revenue__expenses-title-icon">
                  <p class="fb-regular balance-revenue__expenses-title-text">Expenses</p>
                </div>
                <!-- <p class="fd-sm fd-sm--bold balance-revenue__expenses-value">USD 3.132,23</p> -->
              </div>
            </div>
          </div>
          <div class="complete-card__separator"></div>
          <div class="complete-card__wallet">
            <div class="complete-card__wallet-head">
              <h6 class="complete-card__wallet-head__title-text">Wallet</h6>
              <p class="fb-regular complete-card__wallet-head__title-total-currencies">3 Currencies</p>
            </div>
            <div class="complete-card__wallet-data">
              <div class="complete-card__wallet-data__chart">
                <div id="complete-card__wallet-data__donut-chart-1"
                  class="complete-card__wallet-data__donut-chart-render"></div>
                <div class="complete-card__wallet-data__donut-chart-label">
                  <img src="{% static 'assets/media/images/icons/arrow-bullish.svg' %}" alt=""
                    class="complete-card__wallet-data__donut-chart-label-icon"></img>
                  <p class="fd-sm fd-sm--bold complete-card__wallet-data__donut-chart-label-text">2.31%</p>
                </div>
              </div>
              <div class="complete-card__wallet-data__currencies">
                <div class="wallet-data__currency">
                  <img src="{% static 'assets/media/images/icons/logo-btc.svg' %}" alt=""
                    class="wallet-data__currency-icon">
                  <div class="wallet-data__currency-text">
                    <p class="fb-regular fb-regular--bold wallet-data__currency-text-acronym">BTC</p>
                    <p class="fb-regular wallet-data__currency-text-name">Bitcoin</p>
                  </div>
                  <div class="wallet-data__currency-influsion">
                    <img src="{% static 'assets/media/images/icons/arrow-bullish.svg' %}" alt=""
                      class="wallet-data__currency-influsion-icon">
                    <p class="fb-sm wallet-data__currency-influsion-value">2.36%</p>
                  </div>
                </div>
                <div class="wallet-data__currency">
                  <img src="{% static 'assets/media/images/icons/logo-eth.svg' %}" alt=""
                    class="wallet-data__currency-icon">
                  <div class="wallet-data__currency-text">
                    <p class="fb-regular fb-regular--bold wallet-data__currency-text-acronym">ETH</p>
                    <p class="fb-regular wallet-data__currency-text-name">Ethereum</p>
                  </div>
                  <div class="wallet-data__currency-influsion">
                    <img src="{% static 'assets/media/images/icons/arrow-bullish.svg' %}" alt=""
                      class="wallet-data__currency-influsion-icon">
                    <p class="fb-sm wallet-data__currency-influsion-value">1.80%</p>
                  </div>
                </div>
                <div class="wallet-data__currency">
                  <img src="{% static 'assets/media/images/icons/logo-usdt.svg' %}" alt=""
                    class="wallet-data__currency-icon">
                  <div class="wallet-data__currency-text">
                    <p class="fb-regular fb-regular--bold wallet-data__currency-text-acronym">USDT</p>
                    <p class="fb-regular wallet-data__currency-text-name">Tether</p>
                  </div>
                  <div class="wallet-data__currency-influsion">
                    <img src="{% static 'assets/media/images/icons/arrow-bullish.svg' %}" alt=""
                      class="wallet-data__currency-influsion-icon">
                    <p class="fb-sm wallet-data__currency-influsion-value">1.64%</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- End::Complete Card -->

        <!-- Section::Transaction Section -->
        <!-- Start::Standard Card -->
        <div class="standard-card standard-card--type-5-v2">
          <div class="container">
            <div class="standard-card__head">
              <h6 class="standard-card__title">Transaction</h6>
              <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle dropdown-toggle--card-type-5" type="button"
                  id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                  All
                  <img src="{% static 'assets/media/images/icons/arrow-down.svg' %}" alt="">
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                  <li><a class="dropdown-item" href="#">Action</a></li>
                  <li><a class="dropdown-item" href="#">Another action</a></li>
                  <li><a class="dropdown-item" href="#">Something else here</a></li>
                </ul>
              </div>
            </div>
            <div class="standard-card__content" id="transactionContainer">
              {% for txn in binance_transactions %}
              <div class="standard-card__content__list">
                <div class="standard-card__content__list-currency">
                  <img src="{% static 'assets/media/images/icons/' %}{{ txn.asset }}.svg" alt="{{ txn.asset }}" class="standard-card__content__list-currency-icon">
                  <!-- Fallback to generic icon or try to match asset name if you have icons -->
                  <p class="fb-bold standard-card__content__list-currency-name">{{ txn.asset }}</p>
                </div>
                <div class="standard-card__content__list-status">
                  <p class="standard-card__content__list-status-name">{{ txn.type }}</p>
                  {% if txn.type == 'Deposit' %}
                  <img src="{% static 'assets/media/images/icons/green-arrow-up.svg' %}" alt="Deposit"
                    class="standard-card__content__list-status-icon">
                  {% else %}
                  <img src="{% static 'assets/media/images/icons/transaction-arrow-green.svg' %}" alt="Withdraw"
                    class="standard-card__content__list-status-icon" style="transform: rotate(180deg);">
                  {% endif %}
                </div>
                <div class="standard-card__content__list-price">
                  <p class="standard-card__content__list-price-value">{{ txn.amount }}</p>
                </div>
              </div>
              {% empty %}
              <div class="standard-card__content__list">
                <p class="text-center w-100">No recent transactions found.</p>
              </div>
              {% endfor %}
            </div>
            <div class="standard-card__vignette"></div>
          </div>
        </div>
        <!-- End::Standard Card -->

        <!-- Section::Assets Carousel Section -->
        <div class="assets">
          <div class="assets__carousel">
            {% for token in tokens %}
            <div class="standard-card standard-card--type-3-v1 assets__item">
              <div class="container">
                <div class="standard-card__content">
                  <div class="standard-card__content-graph">
                    <img src="{{ token.logo }}" alt="{{ token.logo }}" class="standard-card__content-image">
                    <div class="standard-card__content-chart-wrapper">
                      <div id="standard-card__content-chart-3" class="standard-card__content-chart-render"></div>
                    </div>
                  </div>
                  <div class="standard-card__content-percentage">
                    <img class="standard-card__content-arrow"
                      src="{% static 'assets/media/images/icons/green-arrow-up.svg' %}" alt="">
                    <!-- <p class="standard-card__content-value text-bullish">2.11%</p> -->
                  </div>
                  <div class="standard-card__content-desc">
                    <p class="standard-card__content-desc-currency">{{ token.symbol }}</p>
                    <div class="standard-card__content-desc-prices">
                      <p class="standard-card__content-desc-price">{{ token.price }} USD</p>
                      <p class="standard-card__content-desc-token">{{ token.symbol }}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          <!-- pagination -->
          <div class="slick__pagination">
            <div class="assets-carousel__arrows">
              <a href="#" class="assets-carousel__prev">
                <img src="{% static 'assets/media/images/icons/light-circle-arrow-left.svg'%}" alt="Previous">
              </a>
              <a href="#" class="assets-carousel__next">
                <img src="{% static 'assets/media/images/icons/light-circle-arrow-right.svg' %}" alt="Next">
              </a>
            </div>
            <div class="assets-carousel__pagination slick__pagination--dots">
              <div class="assets-carousel__slick-slider-dots slick-slider-dots"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- <div class="container"> <canvas id="tickerChart" width="800" height="400"></canvas></div> -->


  {% if messages %}
  <div class=" position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="liveToast" class="toast bg-primary" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header">
        <strong class="me-auto">Alert</strong>
        <small class="text-muted">Just now</small>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body bg-primary" id="toastMessage">
        {% for message in messages %}
        {{ message }}
        {% endfor %}
      </div>
    </div>
  </div>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const toastEl = document.getElementById('liveToast');
      const toast = new bootstrap.Toast(toastEl);
      toast.show();
    });
  </script>
  {% endif %}

  {% if request.user.profile.show_terms_modal %}
  <!-- Modal terms and conditions for smartmine-->
  <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content bg-dark text-white">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabel">Terms and Conditions</h1>
        </div>
        <div class="modal-body">
          <div class="container my-5">
            <h1 class="mb-4">Terms and Conditions for SmartMine</h1>
            <p><strong>Effective Date:</strong> 2025</p>
            <p>Welcome to <strong>SmartMine</strong> ("we", "our", "us"). By accessing or using our website
              (<a href="http://www.smrtmine.com" target="_blank"><code>www.smartmine.com</code></a>) and the services
              provided (collectively, the “Platform”), you agree to
              comply
              with and
              be legally bound by these Terms and Conditions. If you do not agree, please do not use our services.</p>

            <h3>1. Acceptance of Terms</h3>
            <p>By registering, accessing, or using the Platform, you confirm that you are at least 18 years old (or the
              age of
              majority in your jurisdiction) and legally able to enter into binding agreements. Your use of SmartMine
              signifies
              your acceptance of these Terms and our Privacy Policy.</p>

            <h3>2. Description of Service</h3>
            <p>SmartMine provides a platform for trading digital assets, including but not limited to cryptocurrencies
              and tokens.
              We facilitate transactions between users and provide trading tools, market information, and account
              management
              services.</p>
            <p>We do <strong>not</strong> provide financial advice or investment guarantees. All trading is conducted at
              your own
              risk.</p>

            <h3>3. Account Registration</h3>
            <p>To access the trading features of SmartMine, you must create an account, provide accurate and complete
              information,
              and verify your identity as required by applicable laws (including KYC/AML policies).</p>
            <p>You are responsible for maintaining the confidentiality of your login credentials and any activities
              under your
              account.</p>

            <h3>4. User Responsibilities</h3>
            <p>By using SmartMine, you agree not to:</p>
            <ul>
              <li>Use the Platform for illegal or fraudulent purposes;</li>
              <li>Violate any local, national, or international laws;</li>
              <li>Upload or distribute malicious code or content;</li>
              <li>Attempt to interfere with our systems or other users;</li>
              <li>Misrepresent your identity or use multiple unauthorized accounts.</li>
            </ul>

            <h3>5. Risk Disclosure</h3>
            <p>Trading digital assets involves a <strong>high level of risk</strong>, including the potential loss of
              your entire
              investment. Prices can fluctuate rapidly and are influenced by various unpredictable factors.</p>
            <p>You understand and agree that SmartMine is <strong>not responsible for any financial losses</strong>
              incurred
              through your use of the Platform.</p>

            <h3>6. Fees and Charges</h3>
            <p>SmartMine may charge fees for trading, withdrawals, deposits, or other services. All applicable fees will
              be
              displayed transparently on the Platform. Fees are <strong>non-refundable</strong> unless explicitly
              stated.</p>

            <h3>7. Intellectual Property</h3>
            <p>All content on SmartMine—including logos, software, graphics, and design—is our intellectual property or
              licensed
              to us. You may not reproduce, copy, or distribute any content without written permission from SmartMine.
            </p>

            <h3>8. Termination</h3>
            <p>We reserve the right to suspend or terminate your account and access to the Platform at any time if you:
            </p>
            <ul>
              <li>Violate these Terms,</li>
              <li>Engage in fraudulent or illegal behavior,</li>
              <li>Cause harm to the Platform or its users.</li>
            </ul>
            <p>Termination may result in the forfeiture of associated data or funds in accordance with applicable
              regulations.</p>

            <h3>9. Disclaimer of Warranties</h3>
            <p>SmartMine provides the Platform on an <strong>“as is”</strong> and <strong>“as available”</strong> basis
              without
              any warranties, express or implied. We do not guarantee uninterrupted access, error-free functionality, or
              the
              accuracy of data displayed.</p>

            <h3>10. Limitation of Liability</h3>
            <p>To the maximum extent permitted by law, SmartMine shall not be liable for:</p>
            <ul>
              <li>Any indirect, incidental, or consequential damages;</li>
              <li>Loss of data, profits, or digital assets;</li>
              <li>Events beyond our reasonable control (e.g., cyberattacks, market crashes).</li>
            </ul>

            <h3>11. Governing Law</h3>
            <p>These Terms and any disputes arising out of or related to your use of SmartMine shall be governed by the
              laws of
              [Insert Jurisdiction]. All disputes will be resolved exclusively in the courts of [Insert Location].</p>

            <h3>12. Amendments to Terms</h3>
            <p>We reserve the right to amend these Terms at any time. We will notify users of material changes, and
              continued use
              of the Platform constitutes acceptance of updated Terms.</p>

            <h3>13. Contact Information</h3>
            <p>If you have any questions or concerns about these Terms, please contact us at:</p>
            <p>
              <strong>SmartMine Support</strong><br>
              Email: <a href="mailto:support@smrtmine.com" target="_blank">support@smartmine.com</a><br>
              Website: <a href="http://www.smrtmine.com" target="_blank">www.smartmine.com</a><br>

            </p>
          </div>
        </div>
        <div class="modal-footer d-flex justify-content-between">
          <form action="{% url 'decline_terms' %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">Decline</button>
          </form>
          <form action="{% url 'accept_terms' %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary">Accept Terms and Conditions</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Include jQuery and Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Script to show modal on page load -->
  {% if request.user.is_authenticated and request.user.profile.show_terms_modal %}
  <script type="text/javascript">
    $(document).ready(function () {
      setTimeout(function () {
        var myModal = new bootstrap.Modal(document.getElementById('staticBackdrop'), {
          backdrop: 'static',
          keyboard: false
        });
        myModal.show();
      }, 500);
    });



    $('#acceptTermsBtn').click(function () {
      $.ajax({
        url: '{% url "hide_terms_modal" %}', // Create this view below
        method: 'POST',
        headers: { 'X-CSRFToken': '{{ csrf_token }}' },
        success: function (response) {
          console.log('Terms modal flag updated');
        }
      });
    });

  </script>
  {% endif %}
  <!-- <script type="text/javascript">
    $(document).ready(function () {
      setTimeout(function () {
        var myModal = new bootstrap.Modal(document.getElementById('staticBackdrop'), {
          backdrop: 'static',
          keyboard: false
        });
        myModal.show();
      }, 500); // Adjust delay as needed (e.g., 500ms)
    });
  </script> -->

  <!-- 
  <script>
    async function fetchData() {
      try {
        const response = await fetch('/dashboard/api/tickers/');
        const data = await response.json();
        return data;
      } catch (error) {
        console.error("Error fetching data:", error);
      }
    }

    async function plotChart() {
      const data = await fetchData();
      if (!data) return;

      const labels = data.map(item => item.symbol);
      const prices = data.map(item => parseFloat(item.price));

      const ctx = document.getElementById('tickerChart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Ticker Prices',
            data: prices,
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }
    plotChart();
  
  {% block js %}
  <!-- Bootstrap JS (place before closing </body>) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Start::Global Bundle Scripts (used by all pages) -->
  <script src="{% static 'assets/js/scripts.bundle.js' %}"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="{% static 'assets/js/custom/sidebar.js' %}"></script>
  <!-- End::Global Bundle Scripts -->
  <!-- Start::Plugins (used by this page) -->
  <script src="{% static 'assets/plugins/apexcharts/apexcharts.min.js' %}"></script>
  <script src="{% static 'assets/plugins/slick/slick.min.js' %}"></script>
  <!-- End::Plugins -->
  <!-- Start::Page Scripts (used by this page) -->
  <script src="{% static 'assets/js/custom/chart.js' %}"></script>
  <script src="{% static 'assets/js/pages/dashboard-page-v1.js' %}"></script>
  <script src="{% static 'assets/js/custom/navbar.js' %}"></script>
  <script src="{% static 'assets/js/custom/custom-select.js' %}"></script>


  {% endblock %}
  {% endblock %}
</body>