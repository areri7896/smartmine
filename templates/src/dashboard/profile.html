{% extends 'src/dashboard/basic.html' %}
{% load static %}
{% load widget_tweaks %}

<title>{% block title %}Update Profile{% endblock %}</title>

{% block css_links %}
<link href="{% static 'assets/media/images/icons/logo.svg' %}" rel="shortcut icon" type="image/x-icon" />
<link href="{% static 'assets/css/styles.bundle.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'assets/plugins/datepicker/css/bootstrap-datepicker.min.css' %}" rel="stylesheet"
  type="text/css" />
<link href="{% static 'assets/css/pages/profile-v1.css' %}" rel="stylesheet" type="text/css" />
{% endblock %}

{% block content %}
<div class="profile profile-v1">
  <div class="container container--dashboard">
    {% if user.is_authenticated %}
    <div class="profile__title">
      <div class="profile__title-icon-wrapper">
        <img src="{{ user.profile.profile_pic.url|default:'/static/assets/media/images/default_profile.png' }}"
          alt="Profile Picture" class="profile__title-icon" />
      </div>
      <div class="profile__title-text">
        <h3 class="profile__title-text-1">Profile and Settings</h3>
        <p class="fd-md profile__title-text-2">Setup your profile</p>
      </div>
    </div>

    <div class="profile__container">
      <div class="profile__content">
        <form action="{% url 'profile' %}" enctype="multipart/form-data" method="POST" class="contact-info__form">
          {% csrf_token %}
          <div class="profile__contact-info">
            <div class="contact-info__photo-profile">
              <div class="photo-profile__group">
                <img src="{{ user.profile.profile_pic.url|default:'/static/assets/media/images/default_profile.png' }}"
                  alt="Profile Picture" class="photo-profile__group-photo" />
                <div class="photo-profile__group-text">
                  <p class="fd-sm fd-sm--bold photo-profile__group-text-name">
                    {{ user.first_name }} {{ user.last_name }}
                  </p>
                  <p class="fb-sm photo-profile__group-text-email">
                    {{ user.email }}
                  </p>
                </div>
              </div>
              <div class="photo-profile__cta">
                {% render_field profile_form.profile_pic class="btn btn-primary btn-sm btn-pill" %}
              </div>
            </div>
            <div class="contact-info__name">
              <div class="contact-info__name-form">
                <p class="fb-regular fb-regular--bod contact-info__name-form-text">Username</p>
                <div class="d-block mini-form-sm__box contact-info__name-form-input">
                  {% render_field user_form.username class="form-control form-control-sm mini-form__input" %}
                </div>
              </div>
              <div class="contact-info__name-form">
                <p class="fb-regular fb-regular--bold contact-info__name-form-text">Email</p>
                <div class="d-block mini-form-sm__box contact-info__name-form-input">
                  {% render_field user_form.email class="form-control form-control-sm mini-form__input" %}
                </div>
              </div>
            </div>
          </div>
          <div class="profile__personal-info">
            <div class="personal-info__name-form">
              <p class="fb-regular fb-regular--bold personal-info__name-form-text">First Name</p>
              <div class="d-block mini-form-sm__box personal-info__name-form-input">
                {% render_field user_form.first_name class="form-control form-control-sm mini-form__input" %}
              </div>
            </div>
            <div class="personal-info__name-form">
              <p class="fb-regular fb-regular--bold personal-info__name-form-text">Last Name</p>
              <div class="d-block mini-form-sm__box personal-info__name-form-input">
                {% render_field user_form.last_name class="form-control form-control-sm mini-form__input" %}
              </div>
            </div>
            <div class="personal-info__name-form personal-info__name-form--date">
              <p class="fb-regular fb-regular--bold personal-info__name-form-text">Date of Birth</p>
              <div type="datepicker" class="d-block mini-form-sm__box personal-info__name-form-input">
                {% render_field profile_form.dob class="form-control form-control-sm mini-form__input" %}
                <img class="personal-info__name-form-input-icon"
                  src="{% static 'assets/media/images/icons/calendar.svg' %}" alt="Calendar" />
              </div>
            </div>
            <div class="personal-info__name-form personal-info__name-form--country">
              <p class="fb-regular fb-regular--bold personal-info__name-form-text">Country of Residence</p>
              <div class="d-block">
                <div class="forms-group forms-select js-forms-select" id="custom-select-form-1">
                  {% render_field profile_form.country class="form-control form-control-sm mini-form__input" %}
                </div>
              </div>
            </div>
          </div>
          <input type="submit" class="btn btn-primary btn-lg btn-pill profile__save-btn" value="Save Changes" />
        </form>
      </div>
    </div>
    {% endif %}
  </div>
</div>

{% if messages %}
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
  <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header" style="background-color: #27f7db">
      <strong class="me-auto">Alert</strong>
      <small class="text-muted">Just now</small>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body" style="background-color: #246cf9" id="toastMessage">
      {% for message in messages %}
      {{ message }}
      {% endfor %}
    </div>
  </div>
</div>
<script>
  window.addEventListener("DOMContentLoaded", () => {
    const toastEl = document.getElementById("liveToast");
    const toast = new bootstrap.Toast(toastEl);
    toast.show();
  });

  $(document).ready(function () {
    $('#id_dob').datepicker({
      format: 'yyyy-mm-dd',
      autoclose: true
    });
  });
</script>
{% endif %}
{% endblock %}

{% block js %}
<script src="{% static 'assets/js/scripts.bundle.js' %}"></script>
<script src="{% static 'assets/js/custom/sidebar.js' %}"></script>
<script src="{% static 'assets/plugins/datepicker/js/bootstrap-datepicker.min.js' %}"></script>
<script src="{% static 'assets/js/custom/navbar.js' %}"></script>
<script src="{% static 'assets/js/custom/custom-select.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'assets/js/custom/datepicker.js' %}"></script>
{% endblock %}